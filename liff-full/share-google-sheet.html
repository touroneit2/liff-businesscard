<!doctype html><html><head><meta charset="UTF-8"><meta content="IE=edge" http-equiv="X-UA-Compatible"><meta content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,viewport-fit=cover,user-scalable=no" name="viewport"><title>分享 LINE 數位版名片</title><meta content="請開啟本連結並按一下「選擇分享對象」來透過 LINE 分享名片" name="description"><meta content="2133031763635285" property="fb:app_id"><meta content="請開啟本連結並按一下「選擇分享對象」來透過 LINE 分享名片" property="og:description"><meta content="zh_TW" property="og:locale"><meta content="筆記國度" property="og:site_name"><meta content="分享 LINE 數位版名片" property="og:title"><meta content="website" property="og:type"><link href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet"><style>[v-cloak]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,body,h1,h2,h3,h4,h5,h6{font-family:'Noto Sans TC',sans-serif}</style><meta content="315" property="og:image:height"><meta content="600" property="og:image:width"><meta content="https://i.imgur.com/PqLcIKj.png" property="og:image"><meta content="https://liff.line.me/1654437282-A1Bj7p4a/share.html" property="og:url"><link href="https://cdn.jsdelivr.net/gh/PamornT/flex2html@main/css/flex2html.css" rel="stylesheet"><style>[v-cloak]{display:none}</style></head><body><script src="https://www.googletagmanager.com/gtag/js?id=UA-39556213-12" async></script><script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],window.GA_MEASUREMENT_ID="UA-39556213-12",gtag("js",new Date),gtag("config","UA-39556213-3"),window.gtagInit=(e=>{const n={app_name:"LINE 數位版名片網站",groups:"liff",send_page_view:!1,transport_type:"beacon"};window.liff&&(n.app_name=`LIFF ${liff.getOS()} ${liff.getVersion()}`,/^U[0-9a-f]{32}$/.test(e)&&(n.user_id=e),liff.isInClient()&&(n.app_version=liff.getLineVersion())),gtag("config",GA_MEASUREMENT_ID,n)}),window.gtagEvent=((e,n,a,t=1)=>new Promise(i=>{gtag("event",n,{event_callback:i,event_category:e,event_label:a,send_to:"liff",value:t})})),window.gtagScreenView=(e=>new Promise(n=>{gtag("event","screen_view",{event_callback:n,screen_name:e,send_to:"liff"})})),window.gtagError=((e,n=!1)=>new Promise(a=>{gtag("event","exception",{description:e.message||"",event_callback:a,fatal:n,send_to:"liff"})})),window.gtagTiming=(async e=>{if(!window.performance)return;const n=Math.round(performance.now());await new Promise(a=>{gtag("event","timing_complete",{event_callback:a,event_category:location.pathname,name:e,send_to:"liff",value:n})})});</script><div class="container my-4 text-monospace" id="app" v-cloak><h3 class="my-3 text-center">分享 LINE 數位版名片</h3><div class="my-3 form-group"><button class="btn align-items-center d-flex justify-content-center btn-block btn-lg my-2 btn-success" type="button" @click="btnShare"><i class="fa mr-2 fa-share-square-o"></i> 分享好友</button><small class="form-text text-muted">按一下「分享好友」按鈕，可以分享給好友或群組。</small></div><div class="my-3 form-group"><button class="btn align-items-center d-flex justify-content-center btn-block btn-lg my-2 btn-info" type="button" @click="btnSend"><i class="fa mr-2 fa-paper-plane-o"></i> 直接傳送</button><small class="form-text text-muted">按一下「直接傳送」按鈕，可以直接傳送到聊天室。</small></div><div class="my-3 form-group"><div class="input-group input-group-lg"><input :value="liffLink" @click="btnCopy" class="form-control" readonly ref="result"><div class="input-group-append"><button class="btn align-items-center d-flex justify-content-center btn-outline-secondary" type="button" @click="btnCopy"><i class="fa mr-2 fa-clipboard"></i> 複製網址</button></div></div><small class="form-text text-muted">按一下「複製網址」按鈕，然後存到 LINE Keep。</small></div><div class="my-3 dropdown"><button class="btn btn-block btn-lg btn-secondary dropdown-toggle" type="button" data-toggle="dropdown">點此查看更多功能</button><div class="dropdown-menu"><a class="dropdown-item" href="https://line.me/R/nv/QRCodeReader" target="_blank"><i class="fa fa-fw fa-qrcode"></i> 點此掃描「行動條碼」</a><a class="dropdown-item" href="https://line.me/R/nv/addFriends" target="_blank"><i class="fa fa-fw fa-address-card"></i> 點此前往「加入好友」</a><a class="dropdown-item" href="https://line.me/R/nv/keep" target="_blank"><i class="fa fa-fw fa-bookmark"></i> 點此前往「LINE Keep」</a><a class="dropdown-item" href="https://fb.me/taichunmin" target="_blank"><i class="fa fa-fw fa-facebook-official"></i> 透過 Facebook 與開發者聯絡</a><button class="dropdown-item" type="button" @click="btnFriendMissing"><i class="fa fa-fw fa-question-circle"></i> 在「分享好友」中找不到好友？</button></div></div><div class="table-responsive" style="background-color:#849ebf"><div class="chatbox pt-3"><div id="flex2html" ref="flex2html"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script><script src="https://cdn.jsdelivr.net/npm/crypto-js@3/crypto-js.min.js"></script><script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/js-base64@3/base64.min.js"></script><script src="https://cdn.jsdelivr.net/npm/json5@2/dist/index.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lodash@4/lodash.min.js"></script><script src="https://cdn.jsdelivr.net/npm/papaparse@5/papaparse.min.js"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1/dist/umd/popper.min.js"></script><script src="https://cdn.jsdelivr.net/npm/qs@6/dist/qs.min.js"></script><script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script><script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.min.js"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js"></script><script src="https://taichunmin.idv.tw/liff-businesscard/js/common.js?cachebust=1618375300865"></script><script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script><script src="https://cdn.jsdelivr.net/gh/PamornT/flex2html@main/js/flex2html.min.js"></script><script>const loginPromise=(async()=>{let e;await liff.init({liffId:"1654437282-A1Bj7p4a"}),window.getSearchParam("liff.state")&&await new Promise(e=>{}),liff.isLoggedIn()||(liff.login({redirectUri:location.href}),await new Promise(e=>{}));try{e=await liff.getProfile()}catch(e){}return window.gtagInit(_.get(e,"userId")),e})();window.vueConfig={el:"#app",data:{liffLink:null,msgs:null,render:null,vcard:null},async mounted(){try{this.showLoading("請稍候","頁面初始化中"),await loginPromise,window.gtagScreenView("瀏覽分享名片網頁"),window.gtagTiming("after loginPromise"),this.liffLink=liff.permanentLink.createUrl(),await Promise.all([this.getTpl(),this.getVcard()]),this.msgs=this.getRenderedMsgs(),console.log(this.msgs);for(const e of this.msgs)window.flex2html("flex2html",e);this.hideLoading(),window.gtagTiming("after mounted"),await this.showSavedAlert()}catch(e){e.message=_.get(e,"response.data.message",e.message),console.error(e),window.gtagError(e,!0),await Swal.fire({icon:"error",title:"頁面初始化失敗",text:e.message})}},methods:{async getTpl(){try{const e=this.paramBase64url("template");if(!e)throw new Error("template is required.");if(this.render=_.template(_.get(await axios.get(e,{params:{cachebust:+new Date},transformResponse:[]}),"data")),!_.isFunction(this.render))throw new Error("");window.gtagTiming("after getTpl")}catch(e){throw e.message=e.message?`名片樣板獲取失敗: ${e.message}`:"名片樣板獲取失敗",this.render=null,e}},async getVcard(){this.vcard=_.mapValues(_.omit(_.fromPairs([...new URL(location).searchParams]),["code","liffClientId","liffRedirectUri","state","template"]),decodeBase64url),window.gtagTiming("after getVcard")},async btnShare(){try{if(window.gtagEvent("瀏覽分享名片網頁","btnShare",this.vcard.template),!liff.isApiAvailable("shareTargetPicker"))throw new Error("不支援 shareTargetPicker，請嘗試更新應用程式版本。");const e=new Date,t=await liff.shareTargetPicker(this.msgs);if("success"!==_.get(t,"status"))throw new Error("使用者取消分享");const a=new Date;await Swal.fire({icon:"success",title:"分享成功"}),a-e>1e3&&liff.closeWindow()}catch(e){e.message=_.get(e,"response.data.message",e.message),console.error(e),window.gtagError(e,!0),await Swal.fire({icon:"error",title:"分享失敗",text:e.message})}},async btnSend(){try{if(window.gtagEvent("瀏覽分享名片網頁","btnSend",this.vcard.template),!this.canSendMessages())throw new Error("請先按「複製網址」，然後在 LINE 聊天視窗內貼上並開啟該網址，才有辦法使用「直接傳送」功能喔！");await liff.sendMessages(this.msgs),await Swal.fire({icon:"success",title:"傳送成功"}),liff.closeWindow()}catch(e){e.message=_.get(e,"response.data.message",e.message),console.error(e),window.gtagError(e,!0),await Swal.fire({icon:"error",title:"傳送失敗",text:e.message})}},async btnCopy(){window.gtagEvent("瀏覽分享名片網頁","btnCopy",this.vcard.template);const e=this.$refs.result;e.select(),e.setSelectionRange(0,999999),document.execCommand("copy"),await Swal.fire({icon:"success",title:"複製成功"})},async showSavedAlert(){const e=window.parseJsonOrDefault(localStorage.getItem("swalFire"));localStorage.removeItem("swalFire"),_.isNil(e)||await Swal.fire(e)},async btnFriendMissing(){await Swal.fire({padding:"0",customClass:{actions:"mt-0 mb-2",content:"pt-3 px-3"},html:'<small class="text-left"><p>如果在「分享好友」的清單中找不到好友，你可以嘗試以下步驟：</p><ol><li>按一下「複製網址」按鈕</li><li>進到聊天室並「貼上」網址</li><li>在好友的聊天室中「開啟」名片網址</li><li>按一下「直接傳送」按鈕傳送名片</li><li>在好友的聊天室中「收回」名片網址</li></ol></small>'})},getRenderedMsgs(){let e=JSON5.parse(this.render({_:_,CryptoJS:CryptoJS,dayjs:dayjs,liffLink:this.liffLink,Qs:Qs,vcard:this.vcard}));return _.includes(["bubble","carousel"],_.get(e,"type"))&&(e={type:"flex",altText:"請在手機上查看數位版名片。",contents:e}),e=_.castArray(e)},canSendMessages(){if(!liff.isInClient())return!1;const e=_.get(liff.getContext(),"type");return!!_.includes(["utou","room","group","square_chat"],e)},paramBase64url(e){const t=window.getSearchParam(e);return t?decodeBase64url(t):null},showLoading(e,t){Swal.fire({title:e,text:t,allowOutsideClick:!1,showConfirmButton:!1,willOpen:()=>{Swal.showLoading()}})},hideLoading(){Swal.close()}}};</script><script>const cfg=window.vueConfig;cfg.methods.getVcard=async function(){try{const e=_.fromPairs(_.map(["apiKey","spreadsheetId","range","key","value"],e=>[e,this.paramBase64url(e)]));if(!_.isString(e.apiKey)||!e.apiKey)throw new Error("無效的 Google Sheets API 金鑰");const a=`https://sheets.googleapis.com/v4/spreadsheets/${e.spreadsheetId}/values/${encodeURIComponent(e.range)}`,s=_.get(await axios.get(a,{params:{key:e.apiKey}}),"data.values",[]);if(!_.isArray(s)||!s.length)throw new Error("空的試算表");console.log(s);const t=s[0].indexOf(e.key);if(t<0)throw new Error(`在試算表的第一列中找不到「${e.key}」`);this.vcard=_.zipObject(s[0],_.find(s.slice(1),a=>a[t]===e.value)),window.gtagTiming("after getVcard")}catch(e){throw e.message=e.message?`無法從 Google 試算表讀取資料: ${e.message}`:"無法從 Google 試算表讀取資料",this.render=null,e}};</script><script>(async()=>{_.isFunction(window.beforeVueCreate)&&await window.beforeVueCreate(),window.vm=new Vue(window.vueConfig)})();</script></body></html>